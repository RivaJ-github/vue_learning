(()=>{let e;const t=[],o=new WeakMap,n=new Set,s=Promise.resolve();let l=!1;const c=new Proxy({foo:1},{get:(t,n)=>(function(t,n){if(!e)return;let s=o.get(t);s||o.set(t,s=new Map);let l=s.get(n);l||s.set(n,l=new Set),l.add(e),e.deps.push(l)}(t,n),t[n]),set(t,n,s){t[n]=s,function(t,n){const s=o.get(t);if(!s)return;const l=s.get(n),c=new Set;l&&l.forEach((t=>{t!==e&&c.add(t)})),c.forEach((e=>{e.options.scheduler?e.options.scheduler(e):e()}))}(t,n)}});!function(o,n){const s=()=>{!function(e){for(let t=0;t<e.deps.length;t++)e.deps[t].delete(e);e.deps.length=0}(s),e=s,t.push(s),console.log(c.foo),t.pop(),e=t[t.length-1]};s.options=n,s.deps=[],s()}(0,{scheduler(e){n.add(e),l||(l=!0,s.then((()=>{n.forEach((e=>e()))})).finally((()=>{l=!1})))}}),c.foo++,c.foo++})();