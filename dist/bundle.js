(()=>{let e;const t=[],r=new WeakMap;function n(t,n){if(!e||!h)return;let o=r.get(t);o||r.set(t,o=new Map);let s=o.get(n);s||o.set(n,s=new Set),s.add(e),e.deps.push(s)}function o(t,n,o,a){const c=r.get(t);if(!c)return;const l=c.get(n),h=c.get(s),p=new Set;if(l&&l.forEach((t=>{t!==e&&p.add(t)})),"ADD"!==o&&"DELETE"!==o||h&&h.forEach((t=>{t!==e&&p.add(t)})),"ADD"===o&&Array.isArray(t)){const t=c.get("length");t&&t.forEach((t=>{t!==e&&p.add(t)}))}Array.isArray(t)&&"length"===n&&c.forEach(((t,r)=>{r>a&&t.forEach((t=>{t!==e&&p.add(t)}))})),p.forEach((e=>{e.options.scheduler?e.options.scheduler(e):e()}))}new Set,Promise.resolve();const s=Symbol(),a=Array.prototype.includes,c={includes:function(...e){let t=a.apply(this,e);return!1===t&&(t=a.apply(this.raw,e)),t}},l={get(e){const t=this.raw,r=t.has(e);if(n(t,e),r){const r=t.get(e);return"object"==typeof r?i(r):r}},set(e,t){const r=this.raw,n=r.has(e),s=r.get(e),a=t.raw||t;r.set(e,a),n?(s!==t||s==s&&t==t)&&o(r,e,"SET"):o(r,e,"ADD")},add(e){const t=this.raw,r=t.has(e),n=t.add(e);return r||o(t,e,"ADD"),n},delete(e){const t=this.raw,r=t.has(e),n=t.delete(e);return r&&o(t,e,"DELETE"),n},forEach(e){const t=this.raw;n(t,s),t.forEach(e)}};let h=!0;["push","pop","shift","unshift","splice"].forEach((e=>{const t=Array.prototype[e];c[e]=function(...e){h=!1;let r=t.apply(this,e);return h=!0,r}}));const p=new Map;function i(e){const t=p.get(e);if(t)return t;const r=function(e,t=!1,r=!1){return new Proxy(e,{get:(e,t,r)=>"raw"===t?e:"size"===t?(n(e,s),Reflect.get(e,t,e)):l[t],has:(e,t)=>(n(e,t),Reflect.has(e,t)),ownKeys:e=>(n(e,Array.isArray(e)?"length":s),Reflect.ownKeys(e)),set(e,t,n,s){if(r)return console.warn(`属性${t}是只读的`),!0;const a=e[t],c=Array.isArray(e)?Number(t)<e.length?"SET":"ADD":Object.prototype.hasOwnProperty.call(e,t)?"SET":"ADD",l=Reflect.set(e,t,n,s);return e===s.raw&&(a===n||a!=a&&n!=n||o(e,t,c,n)),l},deleteProperty(e,t){if(r)return console.warn(`属性${t}是只读的`),!0;const n=Object.prototype.hasOwnProperty.call(e,t),s=Reflect.deleteProperty(e,t);return s&&n&&o(e,t,"DELETE"),s}})}(e);return p.set(e,r),r}const f=i(new Map([[{key:1},{value:1}]]));(function(r,n={}){const o=()=>{!function(e){for(let t=0;t<e.deps.length;t++)e.deps[t].delete(e);e.deps.length=0}(o),e=o,t.push(o);const n=r();return t.pop(),e=t[t.length-1],n};o.options=n,o.deps=[],n.lazy||o()})((()=>{f.forEach((function(e,t){console.log(e),console.log(t)}))})),f.set({key:2},{value:2})})();