(()=>{let e;const t=[],r=new WeakMap;function n(t,n){if(!e||!l)return;let o=r.get(t);o||r.set(t,o=new Map);let s=o.get(n);s||o.set(n,s=new Set),s.add(e),e.deps.push(s)}function o(t,n,o,c){const a=r.get(t);if(!a)return;const l=a.get(n),p=a.get(s),i=new Set;if(l&&l.forEach((t=>{t!==e&&i.add(t)})),"ADD"!==o&&"DELETE"!==o||p&&p.forEach((t=>{t!==e&&i.add(t)})),"ADD"===o&&Array.isArray(t)){const t=a.get("length");t&&t.forEach((t=>{t!==e&&i.add(t)}))}Array.isArray(t)&&"length"===n&&a.forEach(((t,r)=>{r>c&&t.forEach((t=>{t!==e&&i.add(t)}))})),i.forEach((e=>{e.options.scheduler?e.options.scheduler(e):e()}))}new Set,Promise.resolve();const s=Symbol(),c=Array.prototype.includes,a={includes:function(...e){let t=c.apply(this,e);return!1===t&&(t=c.apply(this.raw,e)),t}};let l=!0;["push","pop","shift","unshift","splice"].forEach((e=>{const t=Array.prototype[e];a[e]=function(...e){l=!1;let r=t.apply(this,e);return l=!0,r}}));const p=new Map;const i=function(e){const t=p.get(e);if(t)return t;const r=function(e,t=!1,r=!1){return new Proxy(e,{get:(e,t,r)=>"size"===t?Reflect.get(e,t,e):e[t].bind(e),has:(e,t)=>(n(e,t),Reflect.has(e,t)),ownKeys:e=>(n(e,Array.isArray(e)?"length":s),Reflect.ownKeys(e)),set(e,t,n,s){if(r)return console.warn(`属性${t}是只读的`),!0;const c=e[t],a=Array.isArray(e)?Number(t)<e.length?"SET":"ADD":Object.prototype.hasOwnProperty.call(e,t)?"SET":"ADD",l=Reflect.set(e,t,n,s);return e===s.raw&&(c===n||c!=c&&n!=n||o(e,t,a,n)),l},deleteProperty(e,t){if(r)return console.warn(`属性${t}是只读的`),!0;const n=Object.prototype.hasOwnProperty.call(e,t),s=Reflect.deleteProperty(e,t);return s&&n&&o(e,t,"DELETE"),s}})}(e);return p.set(e,r),r}(new Set(1,2,3));(function(r,n={}){const o=()=>{!function(e){for(let t=0;t<e.deps.length;t++)e.deps[t].delete(e);e.deps.length=0}(o),e=o,t.push(o);const n=r();return t.pop(),e=t[t.length-1],n};o.options=n,o.deps=[],n.lazy||o()})((()=>{console.log(i.size)})),i.add(1)})();